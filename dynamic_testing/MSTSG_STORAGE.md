# Introduction
The purpose of this test was to verify the implementation of secure storage in Safe Paths.   Testing was based on the OWASP principles for testing secure data storage on Android - [0x05d-Testing-Data-Storage.md](https://github.com/OWASP/owasp-mstg/blob/master/Document/0x05d-Testing-Data-Storage.md)

Device:  Android 10 Pixel 3A


# Scope

MSTG-STORAGE-1: "System credential storage facilities need to be used to store sensitive data, such as PII, user credentials or cryptographic keys."

MSTG-STORAGE-2: "No sensitive data should be stored outside of the app container or system credential storage facilities."

MSTG-STORAGE-3: "No sensitive data is written to application logs."

MSTG-STORAGE-4: "No sensitive data is shared with third parties unless it is a necessary part of the architecture."

MSTG-STORAGE-5: "The keyboard cache is disabled on text inputs that process sensitive data."

MSTG-STORAGE-6: "No sensitive data is exposed via IPC mechanisms."

MSTG-STORAGE-7: "No sensitive data, such as passwords or pins, is exposed through the user interface."

MSTG-STORAGE-8: "No sensitive data is included in backups generated by the mobile operating system."

MSTG-STORAGE-9: "The app removes sensitive data from views when moved to the background."

MSTG-STORAGE-10: "The app does not hold sensitive data in memory longer than necessary, and memory is cleared explicitly after use."

MSTG-STORAGE-11: "The app enforces a minimum device-access-security policy, such as requiring the user to set a device passcode."

MSTG-PLATFORM-2: "All inputs from external sources and the user are validated and if necessary sanitized. This includes data received via the UI, IPC mechanisms such as intents, custom URLs, and network sources."


# Summary of Issues Found

[SAF-235](https://pathcheck.atlassian.net/browse/SAF-235): Post migration to a secure DB - historical CROSSED_PATHS data remains in the unencrypted DB - Resolution in progress

[SAF-236](https://pathcheck.atlassian.net/browse/SAF-236): Intersection calculation data may be sensitive and is logged on Android - Resolution in progress

[SAF-450](https://pathcheck.atlassian.net/browse/SAF-450): Remove the WRITE_EXTERNAL_STORAGE permission from the AndroidManifest.xml. - Resolution in progress


# Test Report

## Testing Local Storage for Sensitive Data (MSTG-STORAGE-1 and MSTG-STORAGE-2)

### Static Review

All of the OWASP principles and checks that were static, e.g code review, were conducted.  The only finding was that the AndroidManifest.xml allows logging to external (insecure) storage, but it is not used.

### Dynamic Review

Secure Database - I wasn't able to gain access to the secure database, but a [process](https://gist.github.com/troach-sf/f257bb7b80e6dddd4f3bade81b7b1410) has since been identified so this can be conducted in future checks

Legacy Databases - The RKStorage, logback.db and cordova_bg_geolocation.db SQL lite databases were examined.

Issue: CROSSED_PATHS still seems to contained data not migrated to the secure database


## Testing Logs for Sensitive Data (MSTG-STORAGE-3)

ISSUE: Intersection related calcs are logged

## Determining Whether Sensitive Data is Sent to Third Parties (MSTG-STORAGE-4)
No issues detected.

## Determining Whether the Keyboard Cache Is Disabled for Text Input Fields (MSTG-STORAGE-5)
No such fields

## Determining Whether Sensitive Stored Data Has Been Exposed via IPC Mechanisms (MSTG-STORAGE-6)
No providers

## Checking for Sensitive Data Disclosure Through the User Interface (MSTG-STORAGE-7)
No issues found.

## Testing Backups for Sensitive Data (MSTG-STORAGE-8)
Backup not permitted.

## Finding Sensitive Information in Auto-Generated Screenshots (MSTG-STORAGE-9)
In my view, there is no need to prevent people from screenshotting their own exposure history
